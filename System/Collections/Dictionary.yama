namespace "System.Collections"
{
    using "System";
    using "System.IO";

    public struct KeyValuePair
    {
        public int Key;
        public int Value;

        public static KeyValuePair Init(int key, int value)
        {
            Result.Key = key;
            Result.Value = value;

            return Result;
        }

        public this ~()
        {

        }
    }

    public class Dictionary<TItem>
    {

        #region get/set

        private Array keyArray;
        private Array valueArray;
        public int Length;
        private bool isPrimitiv;
        private Func<bool, object> GetHashCodeDelegate;

        #endregion get/set

        #region ctor

        public this new()
        {
            this.Length = 16;
            this.keyArray = Array.New[16];
            this.valueArray = Array.New[16];
            this.isPrimitiv = false;
            this.GetHashCodeDelegate = (Dictionary.GetHashCodeReference) as Func;

            return this;
        }

        public this ~()
        {
            int length = this.Length;
            Array valueArray = this.valueArray;

            for (int i = 0; i < length; i = i + 1)
            {
                object obj = (valueArray.Data[i]) as object;
                if (obj is null) continue;

                obj = ~obj;
            }

            valueArray = ~valueArray;

            Array keyArray = this.keyArray;

            if (!this.isPrimitiv)
            {
                for (int j = 0; j < length; j = j + 1)
                {
                    object obj = (keyArray.Data[j]) as object;
                    if (obj is null) continue;

                    obj = ~obj;
                }
            }

            keyArray = ~keyArray;
        }

        #endregion ctor

        #region methods

        private static int GetHashCodeReference(&object data)
        {
            int hashResult = (data) as int;
            hashResult = hashResult >> 2;
            hashResult = hashResult & 0xf;

            return hashResult;
        }

        private static int GetHashCodePrimitivString(string primitivString)
        {
            int length = primitivString.Length;
            int hashResult = 0;
            for (int i = 0; i < length; i = i + 1)
            {
                int charValue = primitivString.Data[i];
                hashResult = hashResult + charValue;
                hashResult = hashResult * charValue;
                hashResult = hashResult & 0xf;
            }

            return hashResult;
        }

        public KeyValuePair GetFromIteration(int pos)
        {
            Array valueArray = this.valueArray;
            int value = valueArray.Data[pos];

            Array keyArray = this.keyArray;
            int key = keyArray.Data[pos];

            return KeyValuePair.Init(key, value);
        }

        public bool Add(int key, TItem item)
        {
            Func<bool, object> getHashCode = (this.GetHashCodeDelegate) as Func;
            int hashCode = (getHashCode(key)) as int;

            Array valueArray = this.valueArray;
            int newValue = (item) as int;
            valueArray.Data[hashCode] = newValue;

            Array keyArray = this.keyArray;
            keyArray.Data[hashCode] = key;

            return true;
        }

        #endregion methods

    }
}